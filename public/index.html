<!doctype html>
<html lang="id">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>gameresmi.pw</title>
  <style>
    :root{
      --bg0:#070a14;
      --bg1:#0b1026;
      --panel: rgba(255,255,255,.06);
      --border: rgba(255,255,255,.12);
      --text:#eaf0ff;
      --muted: rgba(234,240,255,.65);

      --neon1:#a855f7; /* purple */
      --neon2:#22d3ee; /* cyan */
      --neon3:#f97316; /* orange */

      --shadow: 0 18px 60px rgba(0,0,0,.55);
      --radius: 18px;
    }

    *{ box-sizing:border-box }
    html,body{ height:100% }
    body{
      margin:0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial, "Noto Sans";
      color:var(--text);
      background: #070a14;
      overflow-x:hidden;
    }

    body::before{
      content:"";
      position:fixed;
      inset:0;
      pointer-events:none;
      opacity:.18;
      background:
        linear-gradient(to right, rgba(255,255,255,.08) 1px, transparent 1px),
        linear-gradient(to bottom, rgba(255,255,255,.08) 1px, transparent 1px);
      background-size: 64px 64px;
      mask-image: radial-gradient(circle at 40% 10%, rgba(0,0,0,1), rgba(0,0,0,.2) 55%, transparent 80%);
    }

    .container{
      max-width: 1180px;
      margin: 0 auto;
      padding: 0 16px;
    }

    .site-header{
      position: sticky;
      top: 0;
      z-index: 50;
      padding: 14px 0;
      backdrop-filter: blur(12px);
      background: rgba(7,10,20,.55);
      border-bottom: 1px solid rgba(255,255,255,.08);
    }
    .header-inner{
      display:flex;
      align-items:center;
      gap: 12px;
    }

    .brand{
      display:flex;
      align-items:center;
      gap: 10px;
      text-decoration:none;
      color: inherit;
      flex: 0 0 auto;
      min-width: 0;
    }
    .logo{
      width: 44px;
      height: 44px;
      border-radius: 16px;
      background:
        radial-gradient(circle at 30% 30%, rgba(255,255,255,.85), transparent 55%),
        linear-gradient(135deg, var(--neon1), var(--neon2), var(--neon3));
      box-shadow: 0 0 0 1px rgba(255,255,255,.18), 0 18px 40px rgba(168,85,247,.25);
      display:grid;
      place-items:center;
      position:relative;
      overflow:hidden;
      flex: 0 0 auto;
    }
    .logo span{
      font-weight: 1000;
      color:#081020;
      letter-spacing:.5px;
      transform: translateY(-.5px);
      text-shadow: 0 1px 0 rgba(255,255,255,.35);
      font-size: 14px;
    }
    .brand-title{
      display:flex;
      flex-direction:column;
      line-height:1.05;
      min-width: 0;
    }
    .brand-title strong{
      font-size: 14px;
      letter-spacing:.2px;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
      max-width: 240px;
    }
    .brand-title span{
      font-size: 12px;
      color: var(--muted);
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
      max-width: 260px;
    }

    .nav{
      display:flex;
      align-items:center;
      gap: 10px;
      flex:1;
      min-width: 0;
      justify-content: space-between;
    }
    .nav-left, .nav-right{
      display:flex;
      align-items:center;
      gap: 10px;
      min-width: 0;
    }

    .link{
      text-decoration:none;
      color: var(--text);
      font-weight: 800;
      font-size: 13px;
      padding: 10px 10px;
      border-radius: 12px;
      transition: transform .15s ease, background .15s ease, box-shadow .15s ease;
      white-space: nowrap;
    }
    .link:hover{
      background: rgba(34,211,238,.10);
      box-shadow: 0 0 0 1px rgba(34,211,238,.25);
      transform: translateY(-1px);
    }

    .dropdown{ position: relative; }
    .dropbtn{
      border: 1px solid rgba(255,255,255,.12);
      background: rgba(255,255,255,.06);
      color:var(--text);
      font-weight: 900;
      padding: 10px 12px;
      border-radius: 12px;
      cursor: pointer;
      display:flex;
      align-items:center;
      gap: 8px;
      transition: box-shadow .15s ease, transform .15s ease, border-color .15s ease;
      white-space: nowrap;
    }
    .dropbtn:hover{
      transform: translateY(-1px);
      border-color: rgba(34,211,238,.35);
      box-shadow: 0 18px 40px rgba(0,0,0,.35);
    }
    .dropbtn:focus{
      outline:none;
      box-shadow: 0 0 0 4px rgba(34,211,238,.18);
    }
    .caret{
      width: 10px; height: 10px;
      border-right: 2px solid rgba(234,240,255,.85);
      border-bottom: 2px solid rgba(234,240,255,.85);
      transform: rotate(45deg);
      margin-top:-2px;
      opacity:.9;
    }

    .menu{
      position:absolute;
      top: calc(100% + 10px);
      left: 0;
      width: 300px;
      background: rgba(7,10,20,.92);
      border: 1px solid rgba(255,255,255,.12);
      border-radius: 20px;
      box-shadow: var(--shadow);
      padding: 10px;
      display:none;
    }
    .menu.open{display:block}
    .menu .grid{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap: 8px;
    }
    .chip{
      display:flex;
      align-items:center;
      justify-content:center;
      text-decoration:none;
      padding: 10px 10px;
      border-radius: 14px;
      font-weight: 900;
      font-size: 12px;
      color: var(--text);
      border: 1px solid rgba(255,255,255,.12);
      background: linear-gradient(135deg, rgba(168,85,247,.10), rgba(34,211,238,.10));
      transition: transform .15s ease, box-shadow .15s ease;
    }
    .chip:hover{
      transform: translateY(-1px);
      box-shadow: 0 0 0 1px rgba(168,85,247,.25), 0 18px 40px rgba(0,0,0,.35);
    }

    .search{
      display:flex;
      align-items:center;
      gap:8px;
      background: rgba(255,255,255,.06);
      border: 1px solid rgba(255,255,255,.12);
      border-radius: 12px;
      padding: 6px 10px;
      min-width: 260px;
      max-width: 360px;
    }
    .search input{
      border:0;
      outline:0;
      width:100%;
      font-size: 13px;
      background: transparent;
      color: var(--text);
      min-width: 0;
    }
    .search input::placeholder{ color: rgba(234,240,255,.55) }

    .cta{
      border:0;
      cursor:pointer;
      font-weight: 1000;
      font-size: 13px;
      padding: 8px 12px;
      border-radius: 12px;
      color: #081020;
      background: linear-gradient(135deg, var(--neon1), var(--neon2), var(--neon3));
      box-shadow: 0 0 0 1px rgba(255,255,255,.18), 0 18px 40px rgba(34,211,238,.18);
      transition: transform .15s ease;
      white-space: nowrap;
      flex: 0 0 auto;
    }
    .cta:hover{ transform: translateY(-1px); }

    .hamburger{
      display:none;
      border: 1px solid rgba(255,255,255,.12);
      background: rgba(255,255,255,.06);
      border-radius: 14px;
      padding: 10px 12px;
      cursor:pointer;
      margin-left:auto;
    }
    .hamburger span{
      display:block;
      width: 18px;
      height: 2px;
      background: rgba(234,240,255,.9);
      margin: 4px 0;
      border-radius: 2px;
    }

    @media (max-width: 980px){
      .search{ min-width: 220px; }
      .brand-title span{ max-width: 210px; }
    }
    @media (max-width: 860px){
      .hamburger{ display:inline-flex; }

      .nav{
        position: fixed;
        left: 16px;
        right: 16px;
        top: 74px;
        background: rgba(7,10,20,.92);
        backdrop-filter: blur(12px);
        border: 1px solid rgba(255,255,255,.12);
        border-radius: 22px;
        box-shadow: var(--shadow);
        padding: 12px;
        display:none;
        flex-direction: column;
        align-items: stretch;
        gap: 12px;
      }
      .nav.open{ display:flex; }
      .nav-left, .nav-right{
        width:100%;
        justify-content: flex-start;
        flex-wrap: wrap;
      }
      .search{
        width: 100%;
        min-width: unset;
        max-width: unset;
      }
      .menu{ position: static; width:100%; margin-top: 10px; }
      .menu .grid{ grid-template-columns: 1fr 1fr; }
    }

    .page{
      max-width: 1180px;
      margin: 22px auto 40px;
      padding: 0 16px;
    }

    .hero{
      border-radius: 30px;
      border: 1px solid rgba(255,255,255,.10);
      background:
        radial-gradient(circle at 20% 10%, rgba(168,85,247,.30), transparent 50%),
        radial-gradient(circle at 85% 20%, rgba(34,211,238,.22), transparent 55%),
        radial-gradient(circle at 55% 95%, rgba(249,115,22,.18), transparent 55%),
        linear-gradient(135deg, rgba(255,255,255,.07), rgba(255,255,255,.04));
      box-shadow: var(--shadow);
      padding: 18px;
      overflow:hidden;
      position:relative;
    }
    .hero::after{
      content:"";
      position:absolute;
      inset:-40%;
      background: linear-gradient(90deg, transparent, rgba(34,211,238,.10), transparent);
      transform: rotate(10deg);
      animation: sweep 6s linear infinite;
      pointer-events:none;
      opacity:.7;
    }
    @keyframes sweep{
      0%{ transform: translateX(-20%) rotate(10deg); }
      100%{ transform: translateX(20%) rotate(10deg); }
    }

    .hero-inner{
      display:grid;
      grid-template-columns: 1.35fr .65fr;
      gap: 14px;
      align-items: center;
      position:relative;
      z-index:1;
    }
    .hero-badge{
      display:inline-flex;
      align-items:center;
      gap:8px;
      padding: 9px 12px;
      border-radius: 999px;
      font-size: 12px;
      font-weight: 1000;
      border: 1px solid rgba(255,255,255,.14);
      background: rgba(255,255,255,.06);
      width: fit-content;
      margin-bottom: 10px;
      box-shadow: 0 0 0 1px rgba(34,211,238,.10);
    }
    .dot{
      width:10px;height:10px;border-radius:99px;
      background: linear-gradient(135deg, var(--neon1), var(--neon2), var(--neon3));
      box-shadow: 0 0 18px rgba(34,211,238,.35);
    }
    .hero h1{
      margin: 0 0 8px;
      font-size: 32px;
      letter-spacing: .2px;
      line-height: 1.08;
    }
    .hero p{
      margin: 0 0 14px;
      color: var(--muted);
      font-size: 14px;
      line-height: 1.7;
      max-width: 62ch;
    }
    .hero-actions{
      display:flex;
      gap: 10px;
      flex-wrap: wrap;
      align-items:center;
    }
    .btn-ghost{
      border: 1px solid rgba(255,255,255,.14);
      background: rgba(255,255,255,.06);
      color:var(--text);
      font-weight: 1000;
      font-size: 13px;
      padding: 10px 14px;
      border-radius: 14px;
      cursor:pointer;
      transition: transform .15s ease, box-shadow .15s ease;
    }
    .btn-ghost:hover{
      transform: translateY(-1px);
      box-shadow: 0 0 0 1px rgba(168,85,247,.18), 0 18px 40px rgba(0,0,0,.35);
    }

    .hero-side{
      background: rgba(255,255,255,.05);
      border: 1px solid rgba(255,255,255,.12);
      border-radius: 24px;
      padding: 14px;
    }
    .stat{
      display:flex;
      justify-content: space-between;
      gap: 12px;
      padding: 10px 10px;
      border-radius: 16px;
      border: 1px dashed rgba(255,255,255,.16);
      background: rgba(255,255,255,.04);
      margin-bottom: 10px;
    }
    .stat strong{ font-size: 14px; font-weight:1000; }
    .stat span{ font-size: 12px; color: var(--muted); }

    @media (max-width: 860px){
      .hero-inner{ grid-template-columns: 1fr; }
      .hero h1{ font-size: 27px; }
    }

    .section-title{
      display:flex;
      align-items:baseline;
      justify-content: space-between;
      gap: 12px;
      margin: 18px 4px 10px;
    }
    .section-title h2{
      margin:0;
      font-size: 16px;
      letter-spacing: .2px;
      font-weight:1000;
    }
    .section-title small{ color: var(--muted); }

    .game-grid{
      display:grid;
      grid-template-columns: repeat(5, minmax(0, 1fr));
      gap: 14px;
    }
    @media (max-width: 1100px){ .game-grid{ grid-template-columns: repeat(4, 1fr); } }
    @media (max-width: 900px){ .game-grid{ grid-template-columns: repeat(3, 1fr); } }
    @media (max-width: 650px){ .game-grid{ grid-template-columns: repeat(2, 1fr); } }
    @media (max-width: 420px){ .game-grid{ grid-template-columns: 1fr; } }

    .game-card{
      padding: 10px;
      border-radius: 18px;
      background: rgba(255,255,255,.05);
      border: 1px solid rgba(255,255,255,.10);
      box-shadow: 0 8px 30px rgba(0,0,0,.25);
      color: inherit;
    }
    .game-card:hover{
      transform: translateY(-2px);
      border-color: rgba(34,211,238,.35);
      box-shadow: 0 18px 55px rgba(0,0,0,.45);
    }

    .thumb{
      width: 100%;
      aspect-ratio: 1 / 1;
      border-radius: 14px;
      border: 1px solid transparent;
      background:
        linear-gradient(135deg, rgba(255,255,255,.06), rgba(255,255,255,.03)) padding-box,
        linear-gradient(135deg,
          rgba(34,211,238,.95),
          rgba(168,85,247,.85),
          rgba(249,115,22,.65)
        ) border-box;
      position: relative;
      overflow: hidden;
      box-shadow:
        inset 0 0 0 1px rgba(255,255,255,.10),
        0 0 26px rgba(34,211,238,.35),
        0 0 70px rgba(168,85,247,.28),
        0 0 110px rgba(249,115,22,.16);
    }

    .thumb::after{
      content:"";
      position:absolute;
      inset:0;
      border-radius: inherit;
      background: linear-gradient(180deg, transparent 55%, rgba(0,0,0,.45));
      pointer-events:none;
    }
    .thumb img{
      width:100%;
      height:100%;
      object-fit: cover;
      display:block;
      border-radius: inherit;
      filter: saturate(1.10) contrast(1.06);
      transform: scale(1.01);
    }

    .thumb-overlay{
      position: absolute;
      left: 0; right: 0; bottom: 0;
      padding: 12px 12px 12px;
      background: linear-gradient(
        180deg,
        rgba(0,0,0,0) 0%,
        rgba(0,0,0,.55) 45%,
        rgba(0,0,0,.78) 100%
      );
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    .game-name{
      margin: 0;
      font-weight: 1000;
      font-size: 13px;
      line-height: 1.25;
      letter-spacing: .2px;
      text-shadow: 0 2px 10px rgba(0,0,0,.65);
      display: -webkit-box;
      -webkit-line-clamp: 2;
      -webkit-box-orient: vertical;
      overflow: hidden;
    }

    .game-meta{
      display:flex;
      flex-wrap:wrap;
      gap: 6px;
      align-items:center;
    }

    .tag{
      font-size: 11px;
      font-weight: 950;
      padding: 6px 8px;
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,.18);
      background: rgba(255,255,255,.08);
      color: rgba(234,240,255,.95);
      backdrop-filter: blur(6px);
      text-decoration: none;
      display:inline-flex;
      align-items:center;
      gap:6px;
      cursor: default;
    }
    a.tag{ cursor:pointer; }
    a.tag:hover{
      border-color: rgba(34,211,238,.40);
      box-shadow: 0 0 14px rgba(34,211,238,.18);
    }

    .tag.neon{
      border-color: rgba(34,211,238,.40);
      box-shadow: 0 0 14px rgba(34,211,238,.18);
    }

    .pager{
      margin-top: 16px;
      display:flex;
      align-items:center;
      justify-content: space-between;
      gap: 12px;
      padding: 12px;
      border-radius: 18px;
      border: 1px solid rgba(255,255,255,.10);
      background: rgba(255,255,255,.04);
    }
    .pager-left{ color: var(--muted); font-size: 12px; }
    .pager-controls{
      display:flex;
      align-items:center;
      gap: 8px;
      flex-wrap: wrap;
      justify-content:flex-end;
    }
    .pbtn{
      border: 1px solid rgba(255,255,255,.14);
      background: rgba(255,255,255,.06);
      color: var(--text);
      font-weight: 1000;
      font-size: 12px;
      padding: 8px 10px;
      border-radius: 12px;
      cursor:pointer;
      transition: transform .15s ease, box-shadow .15s ease, border-color .15s ease;
      min-width: 40px;
      text-align:center;
    }
    .pbtn:hover{
      transform: translateY(-1px);
      border-color: rgba(168,85,247,.30);
      box-shadow: 0 0 0 1px rgba(168,85,247,.12);
    }
    .pbtn[disabled]{
      opacity:.45;
      cursor:not-allowed;
      transform:none;
      box-shadow:none;
    }
    .pbtn.active{
      color:#081020;
      background: linear-gradient(135deg, var(--neon1), var(--neon2));
      border-color: rgba(255,255,255,.18);
      box-shadow: 0 0 18px rgba(34,211,238,.18);
    }

    .empty{
      border: 1px dashed rgba(255,255,255,.18);
      background: rgba(255,255,255,.04);
      border-radius: 18px;
      padding: 14px;
      color: var(--muted);
    }
  </style>
</head>

<body>
  <header class="site-header">
    <div class="container">
      <div class="header-inner">
        <a class="brand" href="/">
          <div class="logo" aria-hidden="true"><span>GG</span></div>
          <div class="brand-title">
            <strong>gameresmi.pw</strong>
            <span>Portal game ‚Ä¢ rapi ‚Ä¢ cepat ‚Ä¢ ‚ÄúHUD approved‚Äù</span>
          </div>
        </a>

        <button class="hamburger" id="hamburger" aria-label="Buka menu" aria-expanded="false">
          <span></span><span></span><span></span>
        </button>

        <nav class="nav" id="nav">
          <div class="nav-left">
            <a class="link" href="/" id="homeLink">Home</a>
            <a class="link" href="#" id="popularLink" title="Nanti bisa pakai sorting">Populer</a>
            <a class="link" href="#" id="latestLink" title="Nanti bisa pakai sorting">Terbaru</a>

            <div class="dropdown">
              <button class="dropbtn" id="genreBtn" aria-haspopup="true" aria-expanded="false">
                Genre <span class="caret" aria-hidden="true"></span>
              </button>

              <div class="menu" id="genreMenu" role="menu" aria-label="Daftar genre">
                <div class="grid">
                  <a class="chip" href="#" data-genre="Action" role="menuitem">Action</a>
                  <a class="chip" href="#" data-genre="RPG" role="menuitem">RPG</a>
                  <a class="chip" href="#" data-genre="Strategy" role="menuitem">Strategy</a>
                  <a class="chip" href="#" data-genre="Sports" role="menuitem">Sports</a>
                  <a class="chip" href="#" data-genre="Racing" role="menuitem">Racing</a>
                  <a class="chip" href="#" data-genre="Adventure" role="menuitem">Adventure</a>
                  <a class="chip" href="#" data-genre="Casual" role="menuitem">Casual</a>
                  <a class="chip" href="#" data-genre="Simulation" role="menuitem">Simulation</a>
                </div>
              </div>
            </div>
          </div>

          <div class="nav-right">
            <div class="search" role="search">
              <input id="searchInput" type="search" placeholder="Cari game‚Ä¶ (contoh: 'Hades')" />
            </div>
            <button class="cta" id="searchBtn" type="button">Cari</button>
          </div>
        </nav>
      </div>
    </div>
  </header>

  <main class="page">
    <section class="hero">
      <div class="hero-inner">
        <div>
          <div class="hero-badge"><span class="dot" aria-hidden="true"></span> New drops ‚Ä¢ Patch notes ‚Ä¢ Clean download</div>
          <h1>Rasa web game-nya dapet: neon, rapi, dan siap tempur.</h1>
          <p>
            Data list diambil real-time dari database. Tombol download lewat API (bucket bisa private).
            Kalau list kosong, itu artinya DB kamu masih sepi‚Äîbukan salah monitor. üòÑ
          </p>
          <div class="hero-actions">
            <button class="cta" type="button" onclick="scrollToGrid()">Lihat List Game</button>
            <button class="btn-ghost" type="button" onclick="openGenre()">Browse Genre</button>
          </div>
        </div>

        <aside class="hero-side" aria-label="Ringkasan">
          <div class="stat">
            <div><strong>15 / halaman</strong><br /><span>Pagination otomatis</span></div>
            <strong>üß©</strong>
          </div>
          <div class="stat">
            <div><strong>R2 Stream</strong><br /><span>Download aman</span></div>
            <strong>üì¶</strong>
          </div>
          <div class="stat" style="margin-bottom:0">
            <div><strong>D1 Metadata</strong><br /><span>List cepat</span></div>
            <strong>‚ö°</strong>
          </div>
        </aside>
      </div>
    </section>

    <div class="section-title" id="gridTop">
      <h2>Game Terbaru</h2>
      <small id="gridInfo">Memuat‚Ä¶</small>
    </div>

    <section class="game-grid" id="gameGrid" aria-label="Daftar game"></section>

    <div class="pager" aria-label="Pagination">
      <div class="pager-left" id="pagerLeft">‚Äî</div>
      <div class="pager-controls" id="pagerControls"></div>
    </div>
  </main>

  <script>
    const PAGE_SIZE = 15;

    const gridEl = document.getElementById("gameGrid");
    const pagerLeftEl = document.getElementById("pagerLeft");
    const pagerControlsEl = document.getElementById("pagerControls");
    const gridInfoEl = document.getElementById("gridInfo");

    const searchInput = document.getElementById("searchInput");
    const searchBtn = document.getElementById("searchBtn");

    let searchTimer = null;

    function escapeHtml(str){
      return String(str ?? "").replace(/[&<>"']/g, (m) => ({
        "&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#039;"
      }[m]));
    }

    function clamp(n, min, max){ return Math.max(min, Math.min(max, n)); }

    function getStateFromUrl(){
      const u = new URL(window.location.href);
      const page = parseInt(u.searchParams.get("page") || "1", 10);
      const q = (u.searchParams.get("q") || "").trim();
      return {
        page: Number.isFinite(page) && page > 0 ? page : 1,
        q
      };
    }

    function setStateToUrl({ page, q }){
      const u = new URL(window.location.href);
      u.searchParams.set("page", String(page));
      if (q) u.searchParams.set("q", q);
      else u.searchParams.delete("q");
      history.pushState({ page, q }, "", u.toString());
    }

    async function fetchGames({ page, q }){
      const u = new URL("/api/games", window.location.origin);
      u.searchParams.set("page", String(page));
      u.searchParams.set("limit", String(PAGE_SIZE));
      if (q) u.searchParams.set("q", q);

      const res = await fetch(u.toString(), { method: "GET" });
      const text = await res.text();
      let data = null;
      try { data = text ? JSON.parse(text) : null; } catch {}

      if (!res.ok) {
        const msg = (data && data.error) ? data.error : (text || res.statusText);
        throw new Error(`${res.status} ${msg}`);
      }
      return data;
    }

    function btn(label, disabled, onClick){
      const b = document.createElement("button");
      b.className = "pbtn";
      b.textContent = label;
      b.disabled = disabled;
      b.addEventListener("click", onClick);
      return b;
    }

    function pageBtn(page, current, q){
      const b = document.createElement("button");
      b.className = "pbtn" + (page === current ? " active" : "");
      b.textContent = String(page);
      b.addEventListener("click", () => goTo(page, q));
      return b;
    }

    function ellipsis(){
      const s = document.createElement("span");
      s.style.opacity = ".7";
      s.style.padding = "0 6px";
      s.textContent = "‚Ä¶";
      return s;
    }

    function renderPager(current, totalPages, start, end, total, q){
      pagerLeftEl.textContent = total === 0 ? "‚Äî" : `Showing ${start}‚Äì${end} of ${total}`;

      const windowSize = 7;
      let from = Math.max(1, current - Math.floor(windowSize / 2));
      let to = Math.min(totalPages, from + windowSize - 1);
      from = Math.max(1, to - windowSize + 1);

      const parts = [];
      parts.push(btn("¬´", current === 1, () => goTo(1, q)));
      parts.push(btn("‚Äπ", current === 1, () => goTo(current - 1, q)));

      if (from > 1) {
        parts.push(pageBtn(1, current, q));
        if (from > 2) parts.push(ellipsis());
      }
      for (let p = from; p <= to; p++) parts.push(pageBtn(p, current, q));
      if (to < totalPages) {
        if (to < totalPages - 1) parts.push(ellipsis());
        parts.push(pageBtn(totalPages, current, q));
      }

      parts.push(btn("‚Ä∫", current === totalPages, () => goTo(current + 1, q)));
      parts.push(btn("¬ª", current === totalPages, () => goTo(totalPages, q)));

      pagerControlsEl.innerHTML = "";
      parts.forEach(el => pagerControlsEl.appendChild(el));
    }

    function renderEmpty(msg){
      gridEl.innerHTML = `<div class="empty" style="grid-column:1/-1">${escapeHtml(msg)}</div>`;
    }

    async function renderGrid(page, q){
      gridInfoEl.textContent = "Memuat‚Ä¶";
      gridEl.innerHTML = "";
      pagerControlsEl.innerHTML = "";
      pagerLeftEl.textContent = "‚Äî";

      try{
        const data = await fetchGames({ page, q });

        const current = clamp(data.page, 1, data.totalPages);
        const total = Number(data.total || 0);
        const start = total === 0 ? 0 : ((current - 1) * data.limit + 1);
        const end = total === 0 ? 0 : Math.min(current * data.limit, total);

        if (total === 0) {
          gridInfoEl.textContent = q ? `Tidak ada hasil untuk "${q}"` : "Belum ada game.";
          renderEmpty(q
            ? `Tidak ada hasil untuk "${q}". Coba kata lain (atau cek penulisan).`
            : "Belum ada game di database. Upload dulu lewat /admin/upload.html."
          );
          return;
        }

        gridInfoEl.textContent = `Menampilkan ${start}‚Äì${end} dari ${total} ‚Ä¢ Halaman ${current}/${data.totalPages}`;

        gridEl.innerHTML = (data.items || []).map(item => {
          const title = escapeHtml(item.title);
          const slug = escapeHtml(item.slug);
          const genre = escapeHtml(item.genre || "‚Äî");
          const platform = escapeHtml(item.platform || "‚Äî");
          const cover = escapeHtml(item.cover_url || "https://picsum.photos/seed/gameresmi_fallback/600/600");

          return `
            <div class="game-card" title="${title}">
              <div class="thumb">
                <img alt="${title}" src="${cover}" loading="lazy" />
                <div class="thumb-overlay">
                  <div class="game-name">${title}</div>
                  <div class="game-meta">
                    <span class="tag neon">${genre}</span>
                    <span class="tag">${platform}</span>
                    <a class="tag" href="/api/download/${slug}">Download</a>
                  </div>
                </div>
              </div>
            </div>
          `;
        }).join("");

        renderPager(current, data.totalPages, start, end, total, q);

      } catch(e){
        gridInfoEl.textContent = "Gagal memuat data.";
        renderEmpty(`ERROR: ${e.message}`);
      }
    }

    function goTo(page, q){
      const target = Math.max(1, page);
      setStateToUrl({ page: target, q: (q || "").trim() });
      renderGrid(target, (q || "").trim());
      document.getElementById("gridTop").scrollIntoView({ behavior: "smooth", block: "start" });
    }

    function applySearch(q){
      goTo(1, (q || "").trim());
    }

    function scrollToGrid(){
      document.getElementById("gridTop").scrollIntoView({ behavior: "smooth", block: "start" });
    }

    function openGenre(){
      const genreMenu = document.getElementById("genreMenu");
      const genreBtn = document.getElementById("genreBtn");
      genreMenu.classList.add("open");
      genreBtn.setAttribute("aria-expanded", "true");
      document.getElementById("gridTop").scrollIntoView({ behavior: "smooth", block: "start" });
    }

    // ====== Header interactions ======
    const nav = document.getElementById('nav');
    const hamburger = document.getElementById('hamburger');
    hamburger.addEventListener('click', () => {
      const open = nav.classList.toggle('open');
      hamburger.setAttribute('aria-expanded', String(open));
    });

    const genreBtn = document.getElementById('genreBtn');
    const genreMenu = document.getElementById('genreMenu');
    function closeGenreMenu(){
      genreMenu.classList.remove('open');
      genreBtn.setAttribute('aria-expanded', 'false');
    }
    genreBtn.addEventListener('click', (e) => {
      e.stopPropagation();
      const open = genreMenu.classList.toggle('open');
      genreBtn.setAttribute('aria-expanded', String(open));
    });
    document.addEventListener('click', () => closeGenreMenu());
    document.addEventListener('keydown', (e) => {
      if (e.key === 'Escape') closeGenreMenu();
    });

    // Genre chips -> set q=Genre
    document.querySelectorAll(".chip[data-genre]").forEach(chip => {
      chip.addEventListener("click", (e) => {
        e.preventDefault();
        const g = chip.getAttribute("data-genre") || "";
        closeGenreMenu();
        searchInput.value = g;
        applySearch(g);
      });
    });

    // Search
    searchInput.addEventListener("keydown", (e) => {
      if (e.key === "Enter") applySearch(searchInput.value);
    });
    searchBtn.addEventListener("click", () => applySearch(searchInput.value));
    searchInput.addEventListener("input", () => {
      clearTimeout(searchTimer);
      searchTimer = setTimeout(() => applySearch(searchInput.value), 350);
    });

    // Back/forward
    window.addEventListener("popstate", () => {
      const st = getStateFromUrl();
      searchInput.value = st.q;
      renderGrid(st.page, st.q);
    });

    // Init
    (function init(){
      const st = getStateFromUrl();
      searchInput.value = st.q;
      renderGrid(st.page, st.q);
    })();
  </script>
</body>
</html>
