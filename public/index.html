<!doctype html>
<html lang="id">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>TSGames: List & Download Game Terlengkap</title>
  <meta name="description" content="Katalog game di gameresmi.pw. Cari judul, pilih genre, dan unduh game." />

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@600;800;900&family=Rajdhani:wght@500;700&display=swap" rel="stylesheet">

  <!-- favicon -->
  <link rel="icon" href="https://drive.google.com/file/d/1mxvORk1gECjcLf3P0cYTcvtwVQyB_dh7/view?usp=sharing" type="image/png">
  <link rel="apple-touch-icon" href="https://drive.google.com/file/d/1mxvORk1gECjcLf3P0cYTcvtwVQyB_dh7/view?usp=sharing">
  <meta name="theme-color" content="#0ea5e9">

  <style>
    :root{
      --bg:#1f2328;
      --bg2:#2b2f33;
      --panel:#f3f4f6;
      --panel2:#ffffff;
      --text:#e8eaed;
      --muted:rgba(232,234,237,.72);
      --dark:#101316;

      --blue:#0ea5e9;
      --blue2:#1d4ed8;

      --pill:#0b5e7a;
      --pillBorder:rgba(255,255,255,.25);

      --line:rgba(255,255,255,.12);
      --line2:rgba(0,0,0,.08);

      --shadow: 0 18px 50px rgba(0,0,0,.35);
      --r:14px;
      --r2:18px;
      --max: 1180px;
    }

    *{ box-sizing:border-box }
    html,body{ height:100% }
body{
  margin:0;
  font-family: "Rajdhani", ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial, "Noto Sans";
  background: radial-gradient(900px 380px at 50% 0%, rgba(14,165,233,.18), transparent 55%),
              linear-gradient(180deg, #14171a, #1f2328 45%, #1b1f23);
  color: var(--text);
  overflow-x:hidden;
}


    a{ color: inherit; text-decoration:none }
    a:hover{ text-decoration:underline }

    .container{ max-width: var(--max); margin: 0 auto; padding: 0 16px; }

    /* Top bar */
    .topbar{
      background:#0e1012;
      border-bottom: 1px solid rgba(255,255,255,.08);
      color: rgba(255,255,255,.85);
      font-size: 12px;
    }
    .topbar .inner{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:12px;
      padding: 10px 0;
    }
    .toplinks{ display:flex; gap:18px; flex-wrap:wrap; align-items:center; }
    .toplinks a{ opacity:.9 }
    .toplinks a:hover{ opacity:1 }
    .login{
      color: #7dd3fc;
      font-weight: 900;
      letter-spacing: .2px;
    }

    /* Header */
    .mast{
      background: #3a3f44;
      border-bottom: 1px solid rgba(255,255,255,.08);
      box-shadow: inset 0 -1px 0 rgba(0,0,0,.25);
    }
    /* Header: rapat tapi logo besar */
.mast .inner{
  padding: 10px 0 10px;     /* <<< bikin tipis */
  display:flex;
  flex-direction:column;
  align-items:center;
  gap: 6px;                 /* <<< rapetin jarak antar elemen */
  text-align:center;
}

.logoLine{ margin:0; }
.badge{
  font-family: "Orbitron", system-ui;
  font-size: 12px;
  font-weight: 900;
  letter-spacing: .6px;
  padding: 6px 12px;
  border-radius: 999px;
  background: rgba(0,0,0,.22);
  border: 1px solid rgba(255,255,255,.14);
}

/* Ini kuncinya: crop area logo biar header nggak jadi tinggi */
.logoCrop{
  height: 120px;            /* tinggi header untuk logo */
  display:flex;
  align-items:center;
  justify-content:center;
  overflow:hidden;          /* <<< potong ruang transparan */
  margin: -6px 0 -10px;     /* <<< rapetin lagi */
}

  
    .brand{
  display:flex;
  align-items:center;
  text-decoration:none;
}

.brandLogo{
  height: 170px;            /* <<< BESARIN logo */
  width:auto;
  display:block;
  transform: translateY(-10px); /* geser sedikit biar pas */
  filter: drop-shadow(0 10px 30px rgba(34,211,238,.22))
          drop-shadow(0 20px 55px rgba(168,85,247,.16));
}

@media (max-width:680px){
  .brandLogo{ height: 52px; }
}

.brandMark{
  width: 96px;
  height: 96px;
  border-radius: 22px;
  display:grid;
  place-items:center;
  background:
    radial-gradient(circle at 30% 30%, rgba(255,255,255,.45), transparent 55%),
    linear-gradient(135deg, rgba(14,165,233,1), rgba(29,78,216,1));
  box-shadow:
    0 0 0 1px rgba(255,255,255,.22),
    0 26px 70px rgba(14,165,233,.22);
  overflow:hidden;
  position:relative;
}
.brandMark::after{
  content:"";
  position:absolute;
  inset:-40%;
  background: linear-gradient(90deg, transparent, rgba(255,255,255,.14), transparent);
  transform: rotate(18deg);
  animation: shine 5.8s linear infinite;
  opacity:.8;
  pointer-events:none;
}
@keyframes shine{
  0%{ transform: translateX(-25%) rotate(18deg); }
  100%{ transform: translateX(25%) rotate(18deg); }
}
.brandMark span{
  font-weight: 1000;
  letter-spacing: 1px;
  color:#071019;
  text-shadow: 0 1px 0 rgba(255,255,255,.35);
  font-size: 22px;
}
@media (max-width: 680px){
  .brandMark{ width: 76px; height: 76px; border-radius: 18px; }
  .brandMark span{ font-size: 18px; }
}

/* tagline: lebih gede + lebih ‚Äúgame‚Äù */
.tagline{
  font-family: "Orbitron", system-ui;
  font-size: 18px;          /* <<< besarin */
  font-weight: 700;
  letter-spacing: .3px;
  color: rgba(255,255,255,.92);
  max-width: 980px;
  line-height: 1.35;
  margin-top: 2px;
}

/* Mobile */
@media (max-width: 680px){
  .logoCrop{ height: 96px; margin: -4px 0 -8px; }
  .brandLogo{ height: 200px; transform: translateY(-8px); }
  .tagline{ font-size: 16px; }
}
    .genreRow{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      justify-content:center;
      align-items:center;
      padding: 2px 0 6px;
    }
    .genrePill{
      display:inline-flex;
      align-items:center;
      justify-content:center;
      padding: 7px 12px;
      border-radius: 999px;
      background: #0b5e7a;
      border: 1px solid rgba(255,255,255,.22);
      color: rgba(255,255,255,.95);
      font-weight: 900;
      font-size: 12px;
      letter-spacing: .2px;
      cursor:pointer;
      user-select:none;
      transition: transform .12s ease, filter .12s ease;
    }
    .genrePill:hover{ transform: translateY(-1px); filter: brightness(1.05); }
    .genrePill.active{
      background: linear-gradient(135deg, rgba(14,165,233,1), rgba(29,78,216,1));
      border-color: rgba(255,255,255,.28);
    }

    /* Main nav */
    .nav{
      background: #f1f3f5;
      color:#111827;
      border-top: 1px solid rgba(255,255,255,.08);
      border-bottom: 1px solid rgba(0,0,0,.12);
    }
    .nav .inner{
      display:flex;
      gap: 18px;
      flex-wrap:wrap;
      padding: 12px 0;
      align-items:center;
      justify-content:center;
      font-weight: 900;
      font-size: 14px;
    }
    .nav a{
      color:#101316;
      opacity:.9;
      padding: 6px 8px;
      border-radius: 10px;
    }
    .nav a:hover{
      opacity:1;
      background: rgba(14,165,233,.10);
      text-decoration:none;
      box-shadow: inset 0 0 0 1px rgba(14,165,233,.18);
    }

    /* Featured */
    .featured{
      margin: 18px 0 18px;
      background: transparent;
    }
    .featuredFrame{
      border: 3px solid rgba(14,165,233,.55);
      border-radius: 10px;
      padding: 18px;
      background: rgba(0,0,0,.22);
      box-shadow: var(--shadow);
      overflow:hidden;
      position:relative;
    }
    .featuredTitle{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap: 12px;
      margin-bottom: 12px;
      color: rgba(255,255,255,.92);
      font-weight: 1000;
      letter-spacing:.2px;
    }
    .featuredTitle small{ color: rgba(255,255,255,.72); font-weight:800; }

    .featControls{ display:flex; gap:10px; align-items:center; }
    .iconBtn{
      width: 38px; height: 38px;
      border-radius: 10px;
      border: 1px solid rgba(255,255,255,.18);
      background: rgba(255,255,255,.08);
      color: rgba(255,255,255,.92);
      cursor:pointer;
      font-weight: 1000;
      user-select:none;
    }
    .iconBtn:hover{ filter:brightness(1.06); }

    .featTrack{
      display:flex;
      gap: 14px;
      overflow:auto;
      scroll-snap-type: x mandatory;
      padding-bottom: 4px;
    }
    .featTrack::-webkit-scrollbar{ height: 10px; }
    .featTrack::-webkit-scrollbar-thumb{ background: rgba(255,255,255,.18); border-radius: 999px; }
    .featCard{
      flex: 0 0 210px;
      scroll-snap-align: start;
      border-radius: 10px;
      background: rgba(255,255,255,.06);
      border: 1px solid rgba(255,255,255,.16);
      overflow:hidden;
      position:relative;
      box-shadow: 0 12px 34px rgba(0,0,0,.35);
      cursor:pointer;
      transition: transform .12s ease;
    }
    .featCard:hover{ transform: translateY(-2px); }
    .featCard img{
      width:100%;
      height: 130px;
      object-fit: cover;
      display:block;
      background:#111827;
    }
    .featCard .cap{
      padding: 10px 10px 12px;
      color: rgba(255,255,255,.92);
    }
    .featCard .cap strong{
      display:block;
      font-size: 13px;
      line-height: 1.2;
      letter-spacing:.2px;
      margin-bottom: 8px;
      max-height: 2.4em;
      overflow:hidden;
    }
    .miniTags{ display:flex; gap:6px; flex-wrap:wrap; }
    .miniTag{
      font-size: 11px;
      font-weight: 900;
      padding: 4px 8px;
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,.18);
      background: rgba(255,255,255,.08);
      color: rgba(255,255,255,.88);
      user-select:none;
    }

    /* Layout: main content + sidebar */
    .content{
      margin-top: 14px;
      display:grid;
      grid-template-columns: 1fr 340px;
      gap: 18px;
      align-items:start;
    }

    @media (max-width: 980px){
      .content{ grid-template-columns: 1fr; }
    }

    /* Left: posts */
    .posts{
      background: transparent;
    }
    .postCard{
      background: var(--panel2);
      color: #111827;
      border-radius: 8px;
      border: 1px solid rgba(0,0,0,.10);
      box-shadow: 0 12px 40px rgba(0,0,0,.20);
      overflow:hidden;
      margin-bottom: 16px;
    }
    .postInner{
      display:grid;
      grid-template-columns: 230px 1fr;
      gap: 0;
    }
    @media (max-width: 700px){
      .postInner{ grid-template-columns: 1fr; }
    }

    .postThumb{
      background: #0f172a;
      border-right: 1px solid rgba(0,0,0,.08);
      min-height: 210px;
    }
    .postThumb img{
      width:100%;
      height:100%;
      min-height: 210px;
      object-fit: cover;
      display:block;
      background:#0f172a;
    }

    .postBody{
      padding: 14px 16px 16px;
    }
    .postTags{ display:flex; gap:8px; flex-wrap:wrap; align-items:center; margin-bottom: 10px; }
    .postTag{
      display:inline-flex;
      align-items:center;
      gap:6px;
      padding: 6px 10px;
      border-radius: 999px;
      border: 1px solid rgba(2,132,199,.22);
      background: rgba(14,165,233,.10);
      color: #0f172a;
      font-weight: 1000;
      font-size: 12px;
      user-select:none;
    }
    .postTitle{
      margin: 0 0 8px;
      font-size: 22px;
      font-weight: 1000;
      letter-spacing:.2px;
      line-height: 1.2;
    }
    .postMeta{
      font-size: 12px;
      color: rgba(17,24,39,.65);
      margin-bottom: 10px;
      font-weight: 800;
    }
    .postDesc{
      margin:0 0 12px;
      color: rgba(17,24,39,.85);
      line-height: 1.65;
      font-size: 13px;
    }
    .postActions{
      display:flex;
      gap: 10px;
      flex-wrap:wrap;
      align-items:center;
    }
    .btn{
      border:0;
      cursor:pointer;
      font-weight: 1000;
      font-size: 13px;
      padding: 10px 12px;
      border-radius: 8px;
      background: #0b5e7a;
      color: #ffffff;
      transition: filter .12s ease, transform .12s ease;
      user-select:none;
    }
    .btn:hover{ filter:brightness(1.05); transform: translateY(-1px); }
    .btn.secondary{
      background: #e5e7eb;
      color:#111827;
      border: 1px solid rgba(0,0,0,.10);
    }
    .mono{ font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", monospace; }

    /* Pager */
    .pager{
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap: 12px;
      flex-wrap:wrap;
      padding: 12px;
      background: rgba(255,255,255,.06);
      border: 1px solid rgba(255,255,255,.14);
      border-radius: 10px;
      color: rgba(255,255,255,.88);
      box-shadow: 0 10px 30px rgba(0,0,0,.25);
    }
    .pager .left{ font-size: 12px; color: rgba(255,255,255,.78); font-weight: 800; }
    .pager .right{ display:flex; gap:8px; flex-wrap:wrap; align-items:center; justify-content:flex-end; }
    .pbtn{
      border: 1px solid rgba(255,255,255,.20);
      background: rgba(255,255,255,.08);
      color: rgba(255,255,255,.92);
      font-weight: 1000;
      font-size: 12px;
      padding: 8px 10px;
      border-radius: 10px;
      cursor:pointer;
      user-select:none;
    }
    .pbtn:hover{ filter:brightness(1.06); }
    .pbtn[disabled]{ opacity:.5; cursor:not-allowed; }
    .pbtn.active{
      background: linear-gradient(135deg, rgba(14,165,233,1), rgba(29,78,216,1));
      border-color: rgba(255,255,255,.25);
      color:#071019;
    }

    /* Sidebar */
    .sidebar{
      position: sticky;
      top: 82px;
    }
    @media (max-width: 980px){
      .sidebar{ position: static; }
    }

    .widget{
      background: #ffffff;
      color: #111827;
      border: 1px solid rgba(0,0,0,.10);
      border-radius: 8px;
      box-shadow: 0 12px 40px rgba(0,0,0,.18);
      margin-bottom: 16px;
      overflow:hidden;
    }
    .widgetHead{
      padding: 12px 12px 10px;
      font-weight: 1000;
      border-bottom: 1px solid rgba(0,0,0,.08);
      background: #f3f4f6;
    }
    .widgetBody{ padding: 12px; }

    .searchRow{
      display:flex; gap:10px; align-items:center;
    }
    .searchRow input{
      flex:1;
      padding: 10px 10px;
      border-radius: 6px;
      border: 1px solid rgba(0,0,0,.18);
      outline:none;
      font-size: 13px;
    }
    .searchRow input:focus{
      border-color: rgba(14,165,233,.55);
      box-shadow: 0 0 0 3px rgba(14,165,233,.18);
    }
    .searchRow button{
      padding: 10px 12px;
      border-radius: 6px;
      border:0;
      font-weight: 1000;
      cursor:pointer;
      color:#fff;
      background: #0b5e7a;
    }
    .hint{
      margin-top: 10px;
      font-size: 12px;
      color: rgba(17,24,39,.72);
      font-weight: 800;
    }

    .genreList{ display:flex; flex-direction:column; gap:10px; }
    .gRow{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap: 10px;
      font-weight: 900;
      font-size: 13px;
    }
    .gRow a{ color: #0b5e7a; text-decoration:none; }
    .gRow a:hover{ text-decoration:underline; }
    .count{
      background: #111827;
      color:#fff;
      font-size: 11px;
      padding: 4px 8px;
      border-radius: 999px;
      font-weight: 1000;
      opacity:.92;
    }

    /* Footer */
    .footer{
      margin-top: 24px;
      padding: 18px 0 24px;
      color: rgba(255,255,255,.75);
      font-size: 12px;
      border-top: 1px solid rgba(255,255,255,.10);
      background: rgba(0,0,0,.18);
    }
    .footer .row{
      display:flex;
      align-items:flex-start;
      justify-content:space-between;
      gap: 16px;
      flex-wrap:wrap;
    }
    .footer strong{ color: rgba(255,255,255,.92); }
    .footer a{ color: #7dd3fc; }

    /* Small screens tweaks */
    @media (max-width: 680px){
      .brandName{ font-size: 30px; }
      .postTitle{ font-size: 18px; }
      .featCard{ flex-basis: 180px; }
    }
  </style>
</head>

<body>
  <div class="topbar">
    <div class="container inner">
      <div class="toplinks">
        <a href="#contact">Contact Me</a>
        <a href="#dmca">DMCA Report</a>
        <a href="#support">Support Us</a>
        <a href="#advertise">Advertise Here</a>
      </div>
      <a class="login" href="/admin/manage/" title="Admin">Login</a>
    </div>
  </div>

  <header class="mast">
    <div class="container inner">
      <div class="logoLine">
        <span class="badge">Katalog Game</span>
      </div>

<a class="brand" href="/" aria-label="TSGames">
<picture>
  <source srcset="https://drive.google.com/file/d/1mxvORk1gECjcLf3P0cYTcvtwVQyB_dh7/view?usp=sharing" type="image/png">
  <img class="brandLogo" src="https://drive.google.com/file/d/1mxvORk1gECjcLf3P0cYTcvtwVQyB_dh7/view?usp=sharing" alt="TSGames" decoding="async" fetchpriority="high">
</picture>

</a>

          <div class="tagline">Cari judul favoritmu, pilih genre, lalu tekan Download di item yang kamu mau.</div>
        </div>
      </div>

      <div class="genreRow" id="genreRow" aria-label="Genre cepat">
        <!-- genre pills (dinamis) -->
      </div>
    </div>
  </header>

  <nav class="nav" aria-label="Menu utama">
    <div class="container inner">
      <a href="/" id="navHome">Home</a>
      <a href="#howto" id="navHow">How to download?</a>
      <a href="#index" id="navIndex">Games Index</a>
      <a href="#archive" id="navArchive">Games Archive</a>
      <a href="#telegram" id="navTelegram">Telegram Channel</a>
    </div>
  </nav>

  <main class="container">
    <section class="featured" aria-label="Featured">
      <div class="featuredFrame">
        <div class="featuredTitle">
          <div>Featured Picks <small id="featNote">pilihan cepat dari katalog</small></div>
          <div class="featControls">
            <button class="iconBtn" id="featPrev" type="button" aria-label="Geser kiri">‚Äπ</button>
            <button class="iconBtn" id="featNext" type="button" aria-label="Geser kanan">‚Ä∫</button>
          </div>
        </div>

        <div class="featTrack" id="featTrack">
          <!-- featured cards -->
        </div>
      </div>
    </section>

    <section class="content" aria-label="Konten">
      <div class="posts">
        <div id="posts"></div>

        <div class="pager" id="pager">
          <div class="left" id="pagerLeft">‚Äî</div>
          <div class="right" id="pagerRight"></div>
        </div>
      </div>

      <aside class="sidebar" aria-label="Sidebar">
        <div class="widget">
          <div class="widgetHead">Find your games</div>
          <div class="widgetBody">
            <div class="searchRow">
              <input id="searchInput" type="search" placeholder="Cari judul / genre / platform‚Ä¶" />
              <button id="searchBtn" type="button">Search</button>
            </div>
            <div class="hint" id="activeHint">Tip: coba ‚ÄúRPG‚Äù, ‚ÄúAction‚Äù, ‚ÄúPC‚Äù, atau judul game.</div>
          </div>
        </div>

        <div class="widget">
          <div class="widgetHead">Game Genres</div>
          <div class="widgetBody">
            <div class="genreList" id="genreList"></div>
          </div>
        </div>

        <div class="widget" id="howto">
          <div class="widgetHead">How to download?</div>
          <div class="widgetBody">
            <div style="font-size:13px; line-height:1.65; color:rgba(17,24,39,.84); font-weight:700">
              <ol style="margin:0; padding-left: 18px">
                <li>Pilih game dari daftar.</li>
                <li>Tekan tombol <b>Download</b> pada item game.</li>
                <li>Jika browser meminta konfirmasi, pilih <b>Save</b>.</li>
              </ol>
              <div style="margin-top:10px; color:rgba(17,24,39,.72); font-size:12px; font-weight:800">
                Catatan: nama file, genre, dan platform bisa kamu lihat di kartu game.
              </div>
            </div>
          </div>
        </div>

        <div class="widget" id="index">
          <div class="widgetHead">Games Index</div>
          <div class="widgetBody">
            <div style="font-size:13px; line-height:1.65; color:rgba(17,24,39,.84); font-weight:700">
              Gunakan pencarian atau klik genre untuk mempercepat filter. Kalau ingin ‚Äúreset‚Äù, kosongkan pencarian lalu Search.
            </div>
          </div>
        </div>
      </aside>
    </section>
  </main>

  <footer class="footer" id="contact">
    <div class="container row">
      <div>
        <strong>gameresmi.pw</strong><br/>
        Koleksi game: cover, genre, platform, dan tautan unduhan per item.
      </div>
      <div id="dmca">
        <strong>DMCA</strong><br/>
        <a href="mailto:dmca@gameresmi.pw">dmca@gameresmi.pw</a>
      </div>
      <div id="support">
        <strong>Support</strong><br/>
        <a href="#support">Support Us</a>
      </div>
      <div id="advertise">
        <strong>Advertise</strong><br/>
        <a href="#advertise">Advertise Here</a>
      </div>
      <div id="telegram">
        <strong>Telegram</strong><br/>
        <a href="#" onclick="alert('Tambahkan link channel Telegram kamu di sini.'); return false;">Telegram Channel</a>
      </div>
    </div>
  </footer>

<script>
  const PAGE_SIZE = 15;

  const els = {
    featTrack: document.getElementById("featTrack"),
    featPrev: document.getElementById("featPrev"),
    featNext: document.getElementById("featNext"),
    posts: document.getElementById("posts"),
    pagerLeft: document.getElementById("pagerLeft"),
    pagerRight: document.getElementById("pagerRight"),
    searchInput: document.getElementById("searchInput"),
    searchBtn: document.getElementById("searchBtn"),
    activeHint: document.getElementById("activeHint"),
    genreRow: document.getElementById("genreRow"),
    genreList: document.getElementById("genreList"),
  };

  function esc(s){
    return String(s ?? "").replace(/[&<>"']/g, m => ({
      "&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#039;"
    }[m]));
  }
  function fmtDate(s){
    if (!s) return "";
    // kalau format D1: "2025-12-18 15:22:10"
    const t = s.replace(" ", "T") + "Z";
    const d = new Date(t);
    if (isNaN(d.getTime())) return s;
    return d.toLocaleDateString("id-ID", { year:"numeric", month:"long", day:"numeric" });
  }
  function fmtBytes(n){
    n = Number(n || 0);
    if (!n) return "-";
    const u = ["B","KB","MB","GB"];
    let i=0;
    while (n >= 1024 && i < u.length-1){ n/=1024; i++; }
    return `${n.toFixed(i===0?0:1)} ${u[i]}`;
  }
  function placeholderSvg(label){
    const text = (label || "GAME").slice(0, 18);
    const svg =
`<svg xmlns="http://www.w3.org/2000/svg" width="800" height="450">
  <defs>
    <linearGradient id="g" x1="0" x2="1">
      <stop offset="0" stop-color="#0ea5e9"/>
      <stop offset="1" stop-color="#1d4ed8"/>
    </linearGradient>
  </defs>
  <rect width="800" height="450" fill="#0f172a"/>
  <rect x="-40" y="-40" width="880" height="530" rx="26" fill="url(#g)" opacity=".22"/>
  <rect x="60" y="70" width="680" height="310" rx="22" fill="rgba(255,255,255,.08)" stroke="rgba(255,255,255,.18)"/>
  <text x="400" y="235" text-anchor="middle" font-family="system-ui,Segoe UI,Roboto" font-size="42" fill="rgba(255,255,255,.90)" font-weight="800">${esc(text)}</text>
</svg>`;
    return "data:image/svg+xml;charset=utf-8," + encodeURIComponent(svg);
  }

  function getState(){
    const u = new URL(location.href);
    const page = Math.max(1, parseInt(u.searchParams.get("page") || "1", 10) || 1);
    const q = (u.searchParams.get("q") || "").trim();
    return { page, q };
  }
  function setState({ page, q }){
    const u = new URL(location.href);
    u.searchParams.set("page", String(page || 1));
    if (q) u.searchParams.set("q", q);
    else u.searchParams.delete("q");
    history.pushState({ page, q }, "", u.toString());
  }

  async function fetchGames({ page, limit, q }){
    const u = new URL("/api/games", location.origin);
    u.searchParams.set("page", String(page || 1));
    u.searchParams.set("limit", String(limit || PAGE_SIZE));
    if (q) u.searchParams.set("q", q);

    const res = await fetch(u.toString(), { cache: "no-store" });
    const ct = res.headers.get("content-type") || "";
    const text = await res.text();

    if (!ct.includes("application/json")){
      const snippet = (text || "").slice(0, 220).replace(/[<>]/g, s => ({'<':'&lt;','>':'&gt;'}[s]));
      throw new Error(`Response bukan JSON (${res.status}). Snippet: ${snippet}`);
    }
    let data = null;
    try { data = text ? JSON.parse(text) : null; } catch {}
    if (!res.ok){
      const msg = (data && data.error) ? data.error : (res.statusText || "Request gagal");
      throw new Error(`${res.status} ${msg}`);
    }
    return data || {};
  }

  function buildGenres(items){
    const map = new Map();
    (items || []).forEach(it => {
      const g = String(it.genre || "").trim();
      if (!g) return;
      map.set(g, (map.get(g) || 0) + 1);
    });
    return [...map.entries()].sort((a,b) => b[1]-a[1]);
  }

  function renderGenrePills(genres, activeQ){
    const top = genres.slice(0, 10).map(([name]) => name);
    if (!top.length){
      els.genreRow.innerHTML = "";
      return;
    }

    els.genreRow.innerHTML = top.map(g => {
      const active = activeQ && activeQ.toLowerCase() === g.toLowerCase();
      return `<button class="genrePill ${active ? "active" : ""}" data-genre="${esc(g)}" type="button">${esc(g)}</button>`;
    }).join("");

    els.genreRow.querySelectorAll("[data-genre]").forEach(btn => {
      btn.addEventListener("click", () => {
        const g = btn.getAttribute("data-genre") || "";
        els.searchInput.value = g;
        goTo(1, g);
      });
    });
  }

  function renderGenreList(genres){
    if (!genres.length){
      els.genreList.innerHTML = `<div style="color:rgba(17,24,39,.65); font-weight:800; font-size:12px">Belum ada genre.</div>`;
      return;
    }
    els.genreList.innerHTML = genres.slice(0, 14).map(([g,c]) => {
      return `
        <div class="gRow">
          <a href="#" data-genre="${esc(g)}">${esc(g)}</a>
          <span class="count">${c}</span>
        </div>
      `;
    }).join("");

    els.genreList.querySelectorAll("[data-genre]").forEach(a => {
      a.addEventListener("click", (e) => {
        e.preventDefault();
        const g = a.getAttribute("data-genre") || "";
        els.searchInput.value = g;
        goTo(1, g);
      });
    });
  }

  function renderFeatured(items){
    const list = (items || []).slice(0, 10);
    if (!list.length){
      els.featTrack.innerHTML = `<div style="color:rgba(255,255,255,.75); font-weight:800">Belum ada featured.</div>`;
      return;
    }

    els.featTrack.innerHTML = list.map(it => {
      const title = it.title || it.slug || "Game";
      const cover = it.cover_url || placeholderSvg(title);
      const g = (it.genre || "").trim();
      const p = (it.platform || "").trim();
      return `
        <div class="featCard" data-slug="${esc(it.slug)}" title="${esc(title)}">
          <img src="${esc(cover)}" alt="${esc(title)}" loading="lazy" onerror="this.src='${placeholderSvg(title)}'"/>
          <div class="cap">
            <strong>${esc(title)}</strong>
            <div class="miniTags">
              ${g ? `<span class="miniTag">${esc(g)}</span>` : ``}
              ${p ? `<span class="miniTag">${esc(p)}</span>` : ``}
            </div>
          </div>
        </div>
      `;
    }).join("");

    els.featTrack.querySelectorAll(".featCard").forEach(card => {
      card.addEventListener("click", () => {
        const slug = card.getAttribute("data-slug") || "";
        const el = document.querySelector(`[data-post="${CSS.escape(slug)}"]`);
        if (el) el.scrollIntoView({ behavior:"smooth", block:"start" });
      });
    });

    els.featPrev.onclick = () => els.featTrack.scrollBy({ left: -520, behavior: "smooth" });
    els.featNext.onclick = () => els.featTrack.scrollBy({ left:  520, behavior: "smooth" });
  }

  function renderPosts(data){
    const items = Array.isArray(data.items) ? data.items : [];
    const page = Number(data.page || 1);
    const limit = Number(data.limit || PAGE_SIZE);
    const total = Number(data.total || 0);
    const totalPages = Number(data.totalPages || Math.max(1, Math.ceil(total / limit)) || 1);

    if (!items.length){
      els.posts.innerHTML = `
        <div class="postCard">
          <div class="postBody" style="padding:16px">
            <div class="postTitle" style="margin:0 0 6px">Tidak ada hasil</div>
            <div class="postDesc" style="margin:0">Coba ganti keyword atau pilih genre lain.</div>
          </div>
        </div>
      `;
      els.pagerLeft.textContent = "‚Äî";
      els.pagerRight.innerHTML = "";
      return;
    }

    els.posts.innerHTML = items.map(it => {
      const title = it.title || it.slug || "Game";
      const cover = it.cover_url || placeholderSvg(title);
      const genre = (it.genre || "").trim();
      const platform = (it.platform || "").trim();
      const desc = (it.short_desc || "").trim() || "Klik Download untuk mengambil file game ini.";
      const date = fmtDate(it.updated_at);
      const size = fmtBytes(it.file_size_bytes);
      const slug = it.slug || "";

      return `
        <article class="postCard" data-post="${esc(slug)}">
          <div class="postInner">
            <div class="postThumb">
              <img src="${esc(cover)}" alt="${esc(title)}" loading="lazy" onerror="this.src='${placeholderSvg(title)}'"/>
            </div>
            <div class="postBody">
              <div class="postTags">
                ${genre ? `<span class="postTag">üéØ ${esc(genre)}</span>` : ``}
                ${platform ? `<span class="postTag">üïπÔ∏è ${esc(platform)}</span>` : ``}
                ${size !== "-" ? `<span class="postTag">üì¶ ${esc(size)}</span>` : ``}
              </div>

              <h3 class="postTitle">${esc(title)}</h3>
              <div class="postMeta">${date ? esc(date) : ""} ${date ? "‚Ä¢ " : ""}<span class="mono">${esc(slug)}</span></div>

              <p class="postDesc">${esc(desc)}</p>

              <div class="postActions">
                <a class="btn" href="/download.html?slug=${encodeURIComponent(slug)}" rel="noopener">Download</a>
                <button class="btn secondary" type="button" data-copy="/download.html?slug=${encodeURIComponent(slug)}">Copy link</button>

              </div>
            </div>
          </div>
        </article>
      `;
    }).join("");

    // copy link
    els.posts.querySelectorAll("[data-copy]").forEach(b => {
      b.addEventListener("click", async () => {
        const path = b.getAttribute("data-copy") || "";
        const url = new URL(path, location.origin).toString();
        try{
          await navigator.clipboard.writeText(url);
          b.textContent = "Copied ‚úì";
          setTimeout(() => (b.textContent = "Copy link"), 1100);
        }catch{
          alert(url);
        }
      });
    });

    const start = total ? ((page - 1) * limit + 1) : 0;
    const end = total ? Math.min(page * limit, total) : 0;

    els.pagerLeft.textContent = total
      ? `Showing ${start}‚Äì${end} of ${total} ‚Ä¢ Page ${page}/${totalPages}`
      : `Page ${page}`;

    // pager buttons
    els.pagerRight.innerHTML = "";
    const mk = (label, disabled, onClick, cls="") => {
      const btn = document.createElement("button");
      btn.className = "pbtn" + (cls ? " " + cls : "");
      btn.textContent = label;
      btn.disabled = disabled;
      btn.onclick = onClick;
      return btn;
    };

    const st = getState();
    const q = st.q || "";

    els.pagerRight.appendChild(mk("¬´", page <= 1, () => goTo(1, q)));
    els.pagerRight.appendChild(mk("‚Äπ", page <= 1, () => goTo(page - 1, q)));

    // number window
    const win = 6;
    let from = Math.max(1, page - Math.floor(win/2));
    let to = Math.min(totalPages, from + win);
    from = Math.max(1, to - win);

    for (let p = from; p <= to; p++){
      els.pagerRight.appendChild(mk(String(p), false, () => goTo(p, q), p === page ? "active" : ""));
    }

    els.pagerRight.appendChild(mk("‚Ä∫", page >= totalPages, () => goTo(page + 1, q)));
    els.pagerRight.appendChild(mk("¬ª", page >= totalPages, () => goTo(totalPages, q)));
  }

  function setHint(q){
    if (!q) {
      els.activeHint.textContent = "Tip: coba ‚ÄúRPG‚Äù, ‚ÄúAction‚Äù, ‚ÄúPC‚Äù, atau judul game.";
      return;
    }
    els.activeHint.innerHTML = `Filter aktif: <span class="mono">${esc(q)}</span> ‚Äî kosongkan lalu Search untuk reset.`;
  }

  async function loadAll(){
    const st = getState();
    els.searchInput.value = st.q || "";
    setHint(st.q || "");

    // featured + genres: ambil pool kecil dari page 1
    try{
      const pool = await fetchGames({ page: 1, limit: 60, q: "" });
      renderFeatured(pool.items || []);
      const genres = buildGenres(pool.items || []);
      renderGenrePills(genres, st.q || "");
      renderGenreList(genres);
    }catch(e){
      // kalau pool gagal, tetap lanjut ke list agar halaman tidak ‚Äúmati total‚Äù
      renderFeatured([]);
      els.genreRow.innerHTML = "";
      els.genreList.innerHTML = `<div style="color:rgba(17,24,39,.65); font-weight:800; font-size:12px">Genre tidak tersedia.</div>`;
    }

    // list utama sesuai state
    try{
      const data = await fetchGames({ page: st.page, limit: PAGE_SIZE, q: st.q || "" });
      renderPosts(data);
    }catch(e){
      els.posts.innerHTML = `
        <div class="postCard">
          <div class="postBody" style="padding:16px">
            <div class="postTitle" style="margin:0 0 6px">Gagal memuat katalog</div>
            <div class="postDesc" style="margin:0">ERROR: <span class="mono">${esc(e.message)}</span></div>
          </div>
        </div>
      `;
      els.pagerLeft.textContent = "‚Äî";
      els.pagerRight.innerHTML = "";
    }
  }

  function goTo(page, q){
    const p = Math.max(1, Number(page || 1));
    const qq = (q || "").trim();
    setState({ page: p, q: qq });
    setHint(qq);
    loadAll();
    window.scrollTo({ top: 0, behavior: "smooth" });
  }

  // Search actions
  els.searchBtn.addEventListener("click", () => goTo(1, els.searchInput.value));
  els.searchInput.addEventListener("keydown", (e) => {
    if (e.key === "Enter") goTo(1, els.searchInput.value);
  });

  window.addEventListener("popstate", () => loadAll());

  // init
  loadAll();
</script>
</body>
</html>

